import dash
from dash import html, dcc
import dash_bootstrap_components as dbc
from dash.dependencies import Input, Output, State

app = dash.Dash(__name__, use_pages=True, external_stylesheets=[dbc.themes.BOOTSTRAP])

# Language toggle with dcc.Store
app.layout = html.Div([
    dcc.Store(id="language-store", data="en"),  # Default language is English

    # Header section with language toggle
    html.Div(
        style={
            "display": "flex",
            "justifyContent": "space-between",
            "alignItems": "center",
            "padding": "10px 20px",
            "backgroundColor": "#f4f4f4"
        },
        children=[
            html.Div(
                html.A(
                    "TCO Classifier",
                    href="/",  # Link to the home page
                    className="home-btn",
                    style={"fontSize": "24px", "fontWeight": "bold", "textDecoration": "none", "color": "#000"}
                )
            ),
            html.Div(
                id="language-selector",
                style={"display": "flex", "alignItems": "center", "gap": "10px"},
                children=[
                    # English Button
                    dbc.Button(
                        [html.Span("ğŸ‡ºğŸ‡¸ English")],
                        id="english-button",
                        color="primary",   # Default: active
                        className="mx-2",
                        style={"fontWeight": "bold"}
                    ),
                    # Chinese Button
                    dbc.Button(
                        [html.Span("ğŸ‡¨ğŸ‡³ ä¸­æ–‡")],
                        id="chinese-button",
                        color="light",  # Default: inactive
                        className="mx-2",
                        style={"fontWeight": "normal"}
                    )
                ]
            )
        ]
    ),

    # Content section
    html.Div(
        id="language-content",
        style={
            "flex": "1",
            "padding": "20px",
            "textAlign": "center"
        }
    ),

# Footer Section (30%)
            html.Div(
                style={
                    "flex": "4",  # White frame with 30% height
                    "backgroundColor": "white",
                    "display": "flex",
                    "flexDirection": "column",
                    "padding": "0",  # Remove padding
                    "margin": "0",  # Remove margin
                    "width": "100%",  # Ensure full width
                    "boxSizing": "border-box",  # Account for padding
                },
                children=[
                    # First Row (Images - 55% of height)
                    html.Div(
                        style={
                            "flex": "5.5",
                            "display": "flex",
                            "justifyContent": "space-evenly",
                            "alignItems": "center"
                        },
                        children=[
                            html.Div(
                                html.Img(
                                    src=f"/assets/photo{i}.png",
                                    style={
                                        "maxHeight": "90%",
                                        "maxWidth": "90%",
                                    }
                                ),
                                style={"flex": "1", "textAlign": "center"}  # Take equal space for each image
                            ) for i in range(1, 8)  # Loop to generate all 7 images
                        ]
                    ),

                    # Second Row (Names - 15% of height)
                    html.Div(
                        style={
                            "flex": "1.5",
                            "display": "flex",
                            "justifyContent": "space-evenly",
                            "alignItems": "center"
                        },
                        children=[
                            html.Div(
                                html.P(person["name"], style={"fontWeight": "bold", "margin": "0"}),
                                style={"flex": "1", "textAlign": "center"}
                            ) for person in [
                                {"name": "Camelia Dorody"},
                                {"name": "Norhazwani Md Yunos"},
                                {"name": "Hasrul Nisham Rosly"},
                                {"name": "Ong Ke Sheng"},
                                {"name": "Chengyoushi Xu"},
                                {"name": "Manzoore Elahi M. Soudagar"},
                                {"name": "Feng Zheng Jie"}
                            ]
                        ]
                    ),

                    # Third Row (Roles - 15% of height)
                    html.Div(
                        style={
                            "flex": "1.5",
                            "display": "flex",
                            "justifyContent": "space-evenly",
                            "alignItems": "center",
                            "fontStyle": "italic",
                        },
                        children=[
                            html.Div(
                                html.P(person["role"], style={"margin": "0"}),
                                style={"flex": "1", "textAlign": "center"}
                            ) for person in [
                                {"role": "Semiconductor Project Leader"},
                                {"role": "Main Supervisor"},
                                {"role": "Co-Supervisor"},
                                {"role": "Developer"},
                                {"role": "Technical Coordinator"},
                                {"role": "Semiconductor Experimental Specialist"},
                                {"role": "Strategic Advisor"}
                            ]
                        ]
                    ),

                    # Fourth Row (Company and Location - 15% of height)
                    html.Div(
                        style={
                            "flex": "1.5",
                            "display": "flex",
                            "justifyContent": "space-evenly",
                            "alignItems": "center",
                        },
                        children=[
                            html.Div(
                                html.P(
                                    [html.Span(person["company"], style={"color": "black"}), html.Br(), person["location"]],
                                    style={"margin": "0"}
                                ),
                                style={"flex": "1", "textAlign": "center"}
                            ) for person in [
                                {"company": "Zhejiang Xingyu Co., Ltd. China", "location": ""},
                                {"company": "Universiti Teknikal Malaysia Melaka", "location": ""},
                                {"company": "Universiti Teknikal Malaysia Melaka", "location": ""},
                                {"company": "Universiti Teknikal Malaysia Melaka", "location": ""},
                                {"company": "Lishui University China", "location": ""},
                                {"company": "Lishui University China", "location": ""},
                                {"company": "Zhejiang Xingyu Co., Ltd. China", "location": ""}
                            ]
                        ]
                    )
                ]
            )
])

# Callback to toggle the language and update button styles
@app.callback(
    [
        Output("language-store", "data"),  # Update selected language
        Output("english-button", "color"),
        Output("english-button", "style"),
        Output("chinese-button", "color"),
        Output("chinese-button", "style"),
    ],
    [
        Input("english-button", "n_clicks"),
        Input("chinese-button", "n_clicks")
    ],
    State("language-store", "data")
)

def toggle_language(english_clicks, chinese_clicks, current_language):
    # Default button styles
    active_style = {"fontWeight": "bold", "boxShadow": "0 4px 6px rgba(0,0,0,0.3)"}
    inactive_style = {"fontWeight": "normal", "boxShadow": "none"}

    ctx = dash.callback_context
    if not ctx.triggered:
        return "en", "primary", active_style, "light", inactive_style

    triggered_id = ctx.triggered[0]["prop_id"].split(".")[0]
    if triggered_id == "english-button":
        return "en", "primary", active_style, "light", inactive_style
    elif triggered_id == "chinese-button":
        return "zh", "light", inactive_style, "primary", active_style

    # Do nothing if no relevant button press
    return current_language, "primary" if current_language == "en" else "light", active_style if current_language == "en" else inactive_style, "primary" if current_language == "zh" else "light", active_style if current_language == "zh" else inactive_style

# Callback to change the content dynamically based on the selected language
@app.callback(
    Output("language-content", "children"),
    Input("language-store", "data")
)
def update_content(language):
    if language == "en":
        return html.Div(
            style={"paddingTop": "20px"},
            children=[
                dbc.Row(
                    align="center",
                    children=[
                        # Left Image Section
                        dbc.Col(
                            html.Div(
                                html.Img(
                                    src="/assets/pic1.png",
                                    style={"maxWidth": "80%", "height": "auto"}
                                ),
                                style={"textAlign": "center"}
                            ),
                            width=6
                        ),
                        # Right Text Section
                        dbc.Col(
                            html.Div([
                                html.H2(
                                    "AI TCO Material Classifier",
                                    style={"fontWeight": "bold", "marginBottom": "15px", "fontSize": "32px"}
                                ),
                                html.P(
                                    """
                                    This project leverages the power of XGBoost to accurately classify Transparent Conductive Oxide (TCO) materials used in solar cells, including AZO, FTO, ITO, MZO, and ZnO.
                                    By analyzing four key optical properties Absorbance, Transmission, Optical Density, and Wavelength, the model provides fast and reliable material predictions.
                                    Designed to support renewable energy research, this AI-driven tool reduces the need for time-consuming physical experiments and helps researchers and engineers accelerate innovation in solar cell technology.
                                    """,
                                    style={"fontSize": "18px", "textAlign": "justify", "maxWidth": "800px", "margin": "0 auto"}
                                ),
                                # Buttons
                                dbc.Row(
                                    justify="center",
                                    className="mt-4",
                                    children=[
                                        dbc.Col(
                                            [
                                                dbc.Button(
                                                    "âš¡ Classify Material",
                                                    href="/predict",  # Link to the prediction page
                                                    color="primary",
                                                    className="w-100 mb-2",
                                                    style={
                                                        "padding": "10px 10px",
                                                        "fontSize": "20px",
                                                        "fontWeight": "600",
                                                    },
                                                ),
                                                html.Div(
                                                    "Enter optical properties to predict the TCO material.",
                                                    style={"fontSize": "14px", "color": "#555", "textAlign": "center"}
                                                ),
                                            ],
                                            width=6
                                        ),
                                        dbc.Col(
                                            [
                                                dbc.Button(
                                                    "ğŸ“Š Visualize Transmission",
                                                    href="/visualize",  # Link to the visualization page
                                                    color="primary",
                                                    className="w-100 mb-2",
                                                    style={
                                                        "padding": "10px 10px",
                                                        "fontSize": "20px",
                                                        "fontWeight": "600",
                                                    },
                                                ),
                                                html.Div(
                                                    "Enter material name and select wavelength range to view the transmission curve.",
                                                    style={"fontSize": "14px", "color": "#555", "textAlign": "center"}
                                                ),
                                            ],
                                            width=6
                                        )
                                    ]
                                )
                            ]),
                            width=6
                        )
                    ]
                )
            ]
        )
    elif language == "zh":
        return html.Div(
            style={"paddingTop": "20px"},
            children=[
                dbc.Row(
                    align="center",
                    children=[
                        # Left Image Section
                        dbc.Col(
                            html.Div(
                                html.Img(
                                    src="/assets/pic1.png",
                                    style={"maxWidth": "80%", "height": "auto"}
                                ),
                                style={"textAlign": "center"}
                            ),
                            width=6
                        ),
                        # Right Text Section
                        dbc.Col(
                            html.Div([
                                html.H2(
                                    "AI TCOææ–™åˆ†ç±»å™¨",
                                    style={"fontWeight": "bold", "marginBottom": "15px", "fontSize": "32px"}
                                ),
                                html.P(
                                    """
                                    è¯¥é¡¹ç›®åˆ©ç”¨XGBoostçš„å¼ºå¤§åŠŸèƒ½ï¼Œå‡†ç¡®åˆ†ç±»å¤ªé˜³èƒ½ç”µæ± ä¸­ä½¿ç”¨çš„é€æ˜å¯¼ç”µæ°§åŒ–ç‰©(TCO)ææ–™ï¼ŒåŒ…æ‹¬AZOã€FTOã€ITOã€MZOå’ŒZnOã€‚é€šè¿‡åˆ†æå››ä¸ªå…³é”®å…‰å­¦ç‰¹æ€§â€”â€”å¸å…‰åº¦ã€é€å°„ç‡ã€å…‰å¯†åº¦å’Œæ³¢é•¿ï¼Œè¯¥æ¨¡å‹èƒ½å¤Ÿå¿«é€Ÿå¯é åœ°é¢„æµ‹ææ–™ç±»å‹ã€‚è¿™ä¸€AIé©±åŠ¨çš„å·¥å…·ä¸“ä¸ºæ”¯æŒå¯å†ç”Ÿèƒ½æºç ”ç©¶è€Œè®¾è®¡ï¼Œå‡å°‘äº†è€—æ—¶çš„ç‰©ç†å®éªŒéœ€æ±‚ï¼Œå¸®åŠ©ç ”ç©¶äººå‘˜å’Œå·¥ç¨‹å¸ˆåŠ é€Ÿå¤ªé˜³èƒ½ç”µæ± æŠ€æœ¯çš„åˆ›æ–°å‘å±•ã€‚
                                    """,
                                    style={"fontSize": "18px", "textAlign": "justify", "maxWidth": "800px", "margin": "0 auto"}
                                ),
                                # Buttons
                                dbc.Row(
                                    justify="center",
                                    className="mt-4",
                                    children=[
                                        dbc.Col(
                                            [
                                                dbc.Button(
                                                    "âš¡ ææ–™åˆ†ç±»",
                                                    href="/predict",  # Link to the prediction page
                                                    color="primary",
                                                    className="w-100 mb-2",
                                                    style={
                                                        "padding": "10px 10px",
                                                        "fontSize": "20px",
                                                        "fontWeight": "600",
                                                    },
                                                ),
                                                html.Div(
                                                    "è¾“å…¥å…‰å­¦ç‰¹æ€§ä»¥é¢„æµ‹TCOææ–™",
                                                    style={"fontSize": "14px", "color": "#555", "textAlign": "center"}
                                                ),
                                            ],
                                            width=6
                                        ),
                                        dbc.Col(
                                            [
                                                dbc.Button(
                                                    "ğŸ“Š é€å°„ç‡å›¾è¡¨",
                                                    href="/visualize",  # Link to the visualization page
                                                    color="primary",
                                                    className="w-100 mb-2",
                                                    style={
                                                        "padding": "10px 10px",
                                                        "fontSize": "20px",
                                                        "fontWeight": "600",
                                                    },
                                                ),
                                                html.Div(
                                                    "è¾“å…¥ææ–™åç§°å¹¶é€‰æ‹©æ³¢é•¿èŒƒå›´ä»¥æŸ¥çœ‹é€å°„æ›²çº¿ã€‚",
                                                    style={"fontSize": "14px", "color": "#555", "textAlign": "center"}
                                                ),
                                            ],
                                            width=6
                                        )
                                    ]
                                )
                            ]),
                            width=6
                        )
                    ]
                )
            ]
        )
    
@app.callback(
    Output("content", "children"),
    Input("language-store", "data")
)

# Run App
if __name__ == "__main__":
    app.run(debug=True, port=8000)